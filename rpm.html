<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiPandu RPM - Jurnal Harian</title>
    <style>
        :root {
            /* THEME: Deep Professional (Kontras Lebih Jelas, Tidak Pucat) */
            --bg-main: #e2e8f0;          /* Abu lebih dalam, lebih "berisi" */
            --card-bg: #ffffff;          /* Kertas Putih */
            --input-bg: #f8fafc;         /* Input abu sangat muda */
            
            /* WARNA UTAMA: Solid Blue (Lebih tegas) */
            --primary: #1e40af;          /* Biru tua profesional */
            --primary-hover: #172554;
            
            /* WARNA AKSEN: Untuk Draft Area */
            --accent: #3b82f6;           /* Biru cerah */
            --accent-bg: #eff6ff;        /* Latar biru sangat muda */
            
            --text-main: #0f172a;        /* Hampir hitam, tajam */
            --text-soft: #475569;        /* Abu tua jelas */
            --border-soft: #cbd5e1;      /* Garis lebih tegas dari sebelumnya */
            
            --danger: #dc2626;
            --word-blue: #2563eb;        /* Biru standar link */
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, sans-serif; }
        
        body { 
            margin: 0; 
            background: var(--bg-main); 
            color: var(--text-main); 
            padding: 30px; 
            min-height: 100vh;
        }
        
        .container { max-width: 950px; margin: auto; }
        
        /* HEADER SIMPEL */
        .header-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 2px solid var(--border-soft); }
        
        h1 { font-size: 22px; margin: 0; color: var(--primary); font-weight: 800; }
        h1 small { font-size: 14px; color: var(--text-soft); font-weight: normal; margin-left: 8px; }

        /* CARD: Lebih Pop-up */
        .card { 
            background: var(--card-bg);
            padding: 25px; 
            border-radius: 12px; 
            /* Shadow lebih dalam agar tidak terlihat pucat */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            margin-bottom: 20px; 
            border: 1px solid var(--border-soft);
        }
        
        label { font-size: 12px; font-weight: 700; color: var(--text-soft); display: block; margin-top: 15px; margin-bottom: 6px; }
        
        /* INPUT */
        input, select, textarea { 
            width: 100%; 
            padding: 10px 12px; 
            background: var(--input-bg); 
            border: 1px solid var(--border-soft); 
            border-radius: 8px; 
            font-size: 14px; 
            color: var(--text-main); 
            transition: 0.2s;
        }
        input:focus, textarea:focus, select:focus { 
            outline: none; 
            border-color: var(--accent); 
            background: #fff;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* DRAFTING AREA (Lebih Jelas) */
        .draft-area { 
            background: var(--accent-bg);
            border: 2px dashed var(--accent); /* Border lebih tebal sedikit */
            padding: 18px; 
            border-radius: 10px; 
            margin-bottom: 20px; 
        }

        /* BUTTONS */
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; display: inline-flex; align-items: center; gap: 8px; font-size: 13px; }
        
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); }
        
        .btn-accent { background: white; border: 1px solid var(--accent); color: var(--accent); }
        .btn-accent:hover { background: var(--accent); color: white; }

        .btn-word { background: var(--word-blue); color: white; }
        .btn-word:hover { background: #1d4ed8; }

        .btn-print { background: transparent; color: var(--text-soft); border: 1px solid var(--border-soft); }
        .btn-print:hover { background: var(--bg-main); color: var(--text-main); }

        /* TABLE */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; border: 1px solid var(--border-soft); }
        th, td { padding: 12px 15px; text-align: left; font-size: 14px; border-bottom: 1px solid var(--border-soft); }
        
        th { background: #f1f5f9; color: var(--primary); font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
        td { color: var(--text-main); vertical-align: top; }
        tr:hover td { background: #f8fafc; }
        
        .print-only { display: none; }

        @media print {
            .no-print { display: none !important; }
            .print-only { display: block; }
            body { background: white; padding: 0; }
            .container { max-width: 100%; }
            .card { border: none; box-shadow: none; padding: 0; margin: 0; }
            table { border: 1px solid #000; width: 100%; }
            th, td { border: 1px solid #000; padding: 8px; }
            h1 { color: black; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-nav no-print">
        <h1>üìî SiPandu RPM <small>| Jurnal Harian</small></h1>
        <div style="display:flex; gap:10px; align-items:center;">
            <button class="btn btn-word" onclick="downloadDoc()">üìÑ Download .doc</button>
            <button class="btn btn-print" onclick="window.print()">üñ®Ô∏è Print</button>
        </div>
    </div>

    <div class="card no-print">
        <div class="draft-area">
            <label style="margin-top:0; display:flex; justify-content:space-between; color:var(--primary); font-size: 14px;">
                <span>üìù Area Penyusunan (Draft)</span>
            </label>
            <textarea id="aiInput" placeholder="Tempel rencana mentah di sini... Contoh: 'Besok Matematika Pecahan. Kegiatan: 1. Penjelasan...'" rows="2" style="margin-top:8px;"></textarea>
            <button class="btn btn-accent" style="margin-top:12px; width:100%; justify-content:center;" onclick="processAI()">‚¨áÔ∏è Salin ke Form di Bawah</button>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;">
            <div><label>Tanggal</label><input type="date" id="tgl"></div>
            <div>
                <label>Mata Pelajaran</label>
                <select id="mapel">
                    <option>Bahasa Indonesia</option><option>Matematika</option><option>Pendidikan Pancasila</option>
                    <option>IPAS</option><option>PJOK</option><option>Seni Budaya</option><option>Bahasa Inggris</option><option>PABP</option>
                </select>
            </div>
            <div><label>Kelas</label><input type="text" id="kls" placeholder="Cth: IV-B"></div>
        </div>

        <label>Tujuan / Materi Pokok</label>
        <input type="text" id="tp" placeholder="Materi singkat...">

        <label>Ringkasan Kegiatan</label>
        <textarea id="kegiatan" rows="3" placeholder="Langkah pembelajaran..."></textarea>

        <button class="btn btn-primary" style="margin-top:20px; width:100%; justify-content:center; font-size:14px;" onclick="tambahJurnal()">‚ûï Masukkan ke Tabel</button>
    </div>

    <div class="card">
        <h2 style="font-size:16px; color:var(--text-main); margin-bottom:15px; border-bottom:2px solid var(--border-soft); padding-bottom:10px; font-weight: 700;">
            Daftar Jurnal
        </h2>
        <table id="tabelRPM">
            <thead>
                <tr>
                    <th width="120">Tanggal</th>
                    <th width="140">Mapel / Kelas</th>
                    <th>Materi</th>
                    <th>Kegiatan</th>
                    <th width="50" class="no-print"></th>
                </tr>
            </thead>
            <tbody id="isiJurnal"></tbody>
        </table>
        
        <div class="print-only" style="margin-top:50px; display:none; justify-content:space-between; font-family: 'Times New Roman', serif;">
            <div style="text-align:center; width:200px;">
                Mengetahui,<br>Kepala Sekolah<br><br><br><br>__________________
            </div>
            <div style="text-align:center; width:200px;">
                Guru Kelas<br><br><br><br><br>__________________
            </div>
        </div>
    </div>
</div>

<script>
    let listRPM = [];

    window.onload = () => {
        const saved = localStorage.getItem('sipandu_jurnal_v3');
        if (saved) { listRPM = JSON.parse(saved); renderTabel(); }
        document.getElementById('tgl').valueAsDate = new Date();
    };

    function processAI() {
        const input = document.getElementById('aiInput').value;
        if(!input) return alert("Tempel teks draft dulu!");
        let foundMateri = "", foundKegiatan = input;
        const materiMatch = input.match(/(Materi|Topik|TP)\s*:(.*?)(?=\n|$)/i);
        if(materiMatch && materiMatch[2]) foundMateri = materiMatch[2].trim();
        const kegMatch = input.match(/(Kegiatan|Langkah)\s*:(.*)/is);
        if(kegMatch && kegMatch[2]) foundKegiatan = kegMatch[2].trim();
        if(foundMateri) document.getElementById('tp').value = foundMateri;
        document.getElementById('kegiatan').value = foundKegiatan;
    }

    function tambahJurnal() {
        const tglInput = document.getElementById('tgl').value;
        const mapelInput = document.getElementById('mapel').value;
        const klsInput = document.getElementById('kls').value;
        const tpInput = document.getElementById('tp').value;
        const kegInput = document.getElementById('kegiatan').value;
        if(!tpInput || !kegInput) return alert("Lengkapi data!");
        const data = { id: Date.now(), tgl: tglInput, mapel: mapelInput, kls: klsInput, tp: tpInput, kegiatan: kegInput };
        listRPM.unshift(data); saveData(); renderTabel();
        document.getElementById('tp').value = ''; document.getElementById('kegiatan').value = ''; document.getElementById('aiInput').value = '';
    }

    function renderTabel() {
        const tbody = document.getElementById('isiJurnal');
        tbody.innerHTML = '';
        if(listRPM.length === 0) { tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding:20px; color:var(--text-soft);">Belum ada data.</td></tr>`; return; }
        listRPM.forEach((item) => {
            const dateObj = new Date(item.tgl);
            const tglIndo = `${dateObj.getDate()}/${dateObj.getMonth()+1}`;
            tbody.innerHTML += `
                <tr>
                    <td style="color:var(--text-soft)">${tglIndo}</td>
                    <td><b>${item.mapel}</b><br><small>${item.kls}</small></td>
                    <td>${item.tp}</td>
                    <td style="white-space: pre-wrap; line-height:1.5;">${item.kegiatan}</td>
                    <td class="no-print">
                        <button onclick="hapusRPM(${item.id})" style="background:none; border:none; color:#ef4444; cursor:pointer; font-size:18px; font-weight:bold;">&times;</button>
                    </td>
                </tr>`;
        });
    }

    function hapusRPM(id) { if(confirm('Hapus?')) { listRPM = listRPM.filter(i => i.id !== id); saveData(); renderTabel(); } }
    function saveData() { localStorage.setItem('sipandu_jurnal_v3', JSON.stringify(listRPM)); }

    function downloadDoc() {
        if(listRPM.length === 0) return alert("Data kosong!");
        let rowsHtml = "";
        listRPM.forEach(item => {
            const dateObj = new Date(item.tgl);
            const tglIndo = `${dateObj.getDate()}/${dateObj.getMonth()+1}/${dateObj.getFullYear()}`;
            rowsHtml += `<tr><td>${tglIndo}</td><td><b>${item.mapel}</b><br>Kls: ${item.kls}</td><td>${item.tp}</td><td>${item.kegiatan.replace(/\n/g, '<br>')}</td></tr>`;
        });
        const html = `<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word'><head><meta charset='utf-8'><style>body{font-family:'Times New Roman';}table{width:100%;border-collapse:collapse;}td,th{border:1px solid black;padding:5px;vertical-align:top;}th{background:#eee;font-weight:bold;}</style></head><body><h2 align="center" style="text-transform:uppercase;">Jurnal Harian Guru</h2><table><thead><tr><th width="100">Tanggal</th><th width="150">Mapel / Kelas</th><th>Materi / TP</th><th>Kegiatan Pembelajaran</th></tr></thead><tbody>${rowsHtml}</tbody></table><br><br><table style="border:none; width:100%;"><tr style="border:none"><td align="center" style="border:none; width:50%;">Mengetahui,<br>Kepala Sekolah<br><br><br><br>__________________________</td><td align="center" style="border:none; width:50%;">Guru Kelas<br><br><br><br><br>__________________________</td></tr></table></body></html>`;
        const blob = new Blob(['\ufeff', html], { type: 'application/msword' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `Jurnal_Harian_${new Date().toISOString().slice(0,10)}.doc`;
        a.click();
    }
</script>

</body>
</html>
